# 🛰️ 黑屏优化模块
## 📌 函数: HD黑屏_打开
### 描述
```
打开黑屏
```
### 原型
```
__int64 __stdcall HC_OpenBS(__int32 窗口序号,__int32 minIndex=0,__int32 maxIndex=0,BOOL 是否主线程调用=FALSE);
```
### 参数
```
__int32 窗口序号 - 窗口序号(从1开始)
__int32 minIndex - 最小模型序号
__int32 maxIndex - 最大模型序号
bool 是否主线程调用 - 是否需要主线程来调用这个CALL
```
### 返回值
```
查看返回值表
```
### 注意事项
```
无
```
### HD黑屏_打开 - 基础示例
```
.版本 2

.子程序 _HD截图打开示例
    .局部变量 窗口序号, 整数型
    .局部变量 打开结果, 逻辑型
    .局部变量 错误码, 长整数型
    
    窗口序号 = 0  ' 主窗口
    
    ' 检查截图状态
    .如果 (HD截图_获取截图状态 (窗口序号) = 1)
        调试输出 ("截图功能已经开启")
        返回 (真)
    .如果结束
    
    ' 开启截图功能
    打开结果 = HD截图_打开 (窗口序号)
    .如果 (打开结果 = 真)
        调试输出 ("截图功能开启成功")
        ' 延时确保截图初始化完成
        HD系统_延时 (200)
    .否则
        错误码 = HD通用_获取最近返回值 (窗口序号)
        .如果 (错误码 = -1032)
            调试输出 ("截图功能已经开启")
            返回 (真)
        .否则
            调试输出 ("截图功能开启失败，错误码：" + 到文本 (错误码))
            返回 (假)
        .如果结束
    .如果结束
```
### HD黑屏_打开 - 进阶用法
```
.版本 2
.子程序 示例2
    调试输出("示例2")
```
### HD黑屏_打开 - 高级应用
```
.版本 2
.子程序 高级示例
    调试输出("高级示例")
```

---
## 📌 函数: HD黑屏_设置模型范围
### 描述
```
设置模型序号的过滤范围
```
### 原型
```
__int64 __stdcall HC_SetBs(__int32 窗口序号,__int32 minIndex=0,__int32 maxIndex=0);
```
### 参数
```
__int32 窗口序号 - 窗口序号(从1开始)
__int32 minIndex - 最小模型序号
__int32 maxIndex - 最大模型序号
```
### 返回值
```
查看返回值表
```
### 注意事项
```
可以适当调整最小或者最大的序号来过滤模型,来实现黑屏,同时还支持图色识别
```
### HD黑屏_设置模型范围 - 基础示例
```
.版本 2

.子程序 测试拦截Sendto, 长整数型, 公开
    .局部变量 窗口序号, 整数型
    .局部变量 进程位数, 整数型
    .局部变量 结果, 长整数型
    
    窗口序号 ＝ 1
    进程位数 ＝ 64  ' X86进程用32，X64进程用64
    
    ' 设置sendto API拦截
    结果 ＝ HDHOOK_设置拦截API_sendto (窗口序号, 进程位数, &HD_HOOK回调函数_sendto, 789456, 假)
    .如果 (结果 ＝ 1)
        调试输出 ("Sendto API拦截设置成功")
    .否则
        调试输出 ("Sendto API拦截设置失败")
    .如果结束
    
    返回 (结果)

.子程序 HD_HOOK回调函数_sendto, 整数型, 公开, 不需要修改直接返回0
    .参数 窗口序号, 整数型
    .参数 插件序号, 整数型
    .参数 rcx, 长整数型, , 套接字
    .参数 rdx, 长整数型, , 缓冲区的指针
    .参数 r8, 长整数型, , 发送的字节数
    .参数 r9, 长整数型, , 标志位
    .参数 l5, 长整数型, , 端口
    .参数 l6, 长整数型, , IP网络字节序
    .参数 rbp, 长整数型
    .参数 rsp, 长整数型
    .参数 rip, 长整数型
    .参数 buffer封包, 整数型
    .参数 bufferMaxSize, 整数型
    .参数 bufferRealSize, 整数型, , 最好用这个参数，发送的真实字节数
    .参数 lparam, 整数型, , HDHOOK_设置拦截API_sendto里的附加参数
    .局部变量 自定义回调参数, HD_HOOK回调类型
    
    调试输出 (rcx, r8, r9, l5, l6)
    
    自定义回调参数.封包类型 ＝ 3
    自定义回调参数.套接字 ＝ rcx
    自定义回调参数.封包长度 ＝ bufferRealSize  ' 这里最好用bufferRealSize不用r8
    .如果真 (bufferRealSize ≥ 1)
        自定义回调参数.封包内容 ＝ 指针到字节集 (buffer封包, r8)
    .如果真结束
    自定义回调参数.附加参数 ＝ lparam
    自定义回调参数.l5 ＝ l5  ' 端口
    自定义回调参数.l6 ＝ l6  ' IP网络字节序
    
    .如果真 (bufferRealSize ＞ 3000)
        返回 (0)
    .如果真结束
    
    启动线程 (&插入一行列表框, HDHOOK_取自定义回调参数_内存地址 (自定义回调参数), )
    
    返回 (0)  ' 0表示不修改并且走原有流程
```
### HD黑屏_设置模型范围 - 进阶用法
```
.版本 2
.子程序 示例2
    调试输出("示例2")
```
### HD黑屏_设置模型范围 - 高级应用
```
.版本 2
.子程序 高级示例
    调试输出("高级示例")
```

---
## 📌 函数: HD黑屏_关闭
### 描述
```
关闭黑屏
```
### 原型
```
__int64 __stdcall HC_CloseBS(__int32 窗口序号,BOOL 是否主线程调用=FALSE);
```
### 参数
```
__int32 窗口序号 - 窗口序号(从1开始)
bool 是否主线程调用 - 是否需要主线程来调用这个CALL
```
### 返回值
```
查看返回值表
```
### 注意事项
```
无
```
### HD黑屏_关闭 - 基础示例
```
.版本 2

.子程序 测试关闭黑屏, 逻辑型, 公开
    .局部变量 窗口序号, 整数型
    .局部变量 结果, 逻辑型
    
    窗口序号 ＝ 1
    
    调试输出 ("准备关闭黑屏功能")
    
    ' 关闭黑屏功能
    结果 ＝ HD黑屏_关闭 (窗口序号, 假)
    .如果 (结果 ＝ 真)
        调试输出 ("黑屏功能关闭成功")
        调试输出 ("目标窗口已恢复正常显示")
    .否则
        调试输出 ("黑屏功能关闭失败")
    .如果结束
    
    返回 (结果)
```
### HD黑屏_关闭 - 进阶用法
```
.版本 2
.子程序 示例2
    调试输出("示例2")
```
### HD黑屏_关闭 - 高级应用
```
.版本 2
.子程序 高级示例
    调试输出("高级示例")
```

---
