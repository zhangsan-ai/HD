# 🛰️ LUA模块(LUA)
## 📌 函数: HDLUA_读文件
### 描述
```
执行或加载LUA文件
```
### 原型
```
__int64 __stdcall HCLUA_ReadFile(__int32 窗口序号,char* 文件名路径,__int32 LUA标识符,BOOL 是否执行=FALSE,BOOL 是否需要拿到返回值=FALSE,BOOL 是否主线程调用=FALSE);
```
### 参数
```
__int32 窗口序号 - 窗口序号(从1开始)
char* 文件名路径 - LUA文件名路径
__int32 LUA标识符 - 一个任意整数的标识(不要重复就行)
bool 是否执行 - 是否直接执行LUA文件
```
### 返回值
```
是否需要拿到返回值
是否主线程调用:是否需要主线程来调用这个CALL
返回值:
查看返回值表
```
### 注意事项
```
LUA标识符:当【是否需要拿到返回值】参数为真的时候,用作线程的标识符,方便主动退出线程，标识符规则:不要太大了{0到100}以内就行是否执行:真表示执行并加载LUA(比如:注入一些自定义LUA接口同时还能执行LUA),反之只是加载LUA文件(比如:注入一些自定义LUA接口)是否需要拿到返回值:真表示堵塞直到LUA文件执行完毕并获取返回值，反之表示开启一根线程执行(无法拿到返回值,可以在LUA文件中做一些耗时的操作)
```
### HDLUA_读文件 - 基础示例
```
.版本 2

.子程序 _HDDMA读字节示例
    .局部变量 窗口序号, 整数型
    .局部变量 进程PID, 整数型
    .局部变量 目标地址, 长整数型
    .局部变量 字节值, 整数型
    
    窗口序号 ＝ 1
    进程PID ＝ 1234  ' 目标进程PID
    目标地址 ＝ 4194304  ' 0x400000
    
    字节值 ＝ HDDMA_读字节 (窗口序号, 进程PID, 目标地址)
    
    调试输出 ("读取字节值: " ＋ 到文本 (字节值) ＋ " (0x" ＋ 到十六进制 (字节值) ＋ ")")
    调试输出 ("详细信息: " ＋ HD通用_获取最近返回json (窗口序号))
```
### HDLUA_读文件 - 进阶用法
```
.版本 2
.子程序 示例2
    调试输出("示例2")
```
### HDLUA_读文件 - 高级应用
```
.版本 2
.子程序 高级示例
    调试输出("高级示例")
```

---
## 📌 函数: HDLUA_结束LUA
### 描述
```
关闭LUA线程
```
### 原型
```
__int64 __stdcall HCLUA_CloseLua(__int32 窗口序号,__int32 LUA标识符=-1);
```
### 参数
```
__int32 窗口序号 - 窗口序号(从1开始)
__int32 LUA标识符 - 通过标识符来停止LUA线程
```
### 返回值
```
查看返回值表
```
### 注意事项
```
LUA标识符:调用【HCLUA_ReadFile】接口指定的【LUA标识符】参数,一一对应,-1表示全部LUA线程退出！！！
```
### HDLUA_结束LUA - 进阶用法
```
.版本 2
.子程序 示例2
    调试输出("示例2")
```
### HDLUA_结束LUA - 高级应用
```
.版本 2
.子程序 高级示例
    调试输出("高级示例")
```

---
## 📌 函数: HDLUA_执行CALL
### 描述
```
执行被注册过的LUA函数
```
### 原型
```
__int64 __stdcall HCLUA_ExcuteCall(__int32 窗口序号,char* 函数名,__int32 参数数量=0,__int64 rcx=0,__int64 rdx=0,__int64 r8=0,__int64 r9=0,__int64 lparam5=0,__int64 lparam6=0,BOOL 是否主线程调用=FALSE);
```
### 参数
```
__int32 窗口序号 - 窗口序号(从1开始)
char* 函数名 - 被注册过的函数名
__int32 参数数量 - 参数数量
__int64 rcx - CALL参数
__int64 rdx - CALL参数
__int64 r8 - CALL参数
__int64 r9 - CALL参数
 l5 - CALL参数
 l6 - CALL参数
bool 是否主线程调用 - 是否主线程调用
```
### 返回值
```
查看返回值表
```
### 注意事项
```
json:{\"error\":0,\"ret\":AAA,\"data\":XXX}
```
### HDLUA_执行CALL - 基础示例
```
.版本 2

.子程序 32位CALL调用示例
    .局部变量 窗口序号, 整数型
    .局部变量 MessageBox地址, 长整数型
    .局部变量 调用结果, 长整数型
    .局部变量 窗口句柄, 长整数型
    .局部变量 消息文本, 长整数型
    .局部变量 标题文本, 长整数型
    .局部变量 按钮类型, 长整数型
    
    窗口序号 ＝ 1
    MessageBox地址 ＝ 2003292355  ' MessageBoxA函数地址
    窗口句柄 ＝ 0
    消息文本 ＝ 取变量地址 ("HD自动化测试消息")
    标题文本 ＝ 取变量地址 ("提示")
    按钮类型 ＝ 0  ' MB_OK
    
    ' 调用32位MessageBoxA函数
    调用结果 ＝ HC_CALLX86 (窗口序号, MessageBox地址, 窗口句柄, 消息文本, 标题文本, 按钮类型, 0, 0, 0, 0)
    
    .如果 (调用结果 ≠ 0)
        调试输出 ("32位CALL调用成功")
        调试输出 ("用户点击了按钮，返回值：" ＋ 到文本 (调用结果))
        
        ' MessageBox返回值处理
        .判断开始 (调用结果)
            .如果 (1)  ' IDOK
                调试输出 ("用户点击了确定按钮")
                
            .如果 (2)  ' IDCANCEL
                调试输出 ("用户点击了取消按钮")
                
            .如果 (6)  ' IDYES
                调试输出 ("用户点击了是按钮")
                
            .如果 (7)  ' IDNO
                调试输出 ("用户点击了否按钮")
                
            .默认
                调试输出 ("未知返回值")
        .判断结束
        
    .否则
        调试输出 ("32位CALL调用失败")
    .如果结束
```
### HDLUA_执行CALL - 进阶用法
```
.版本 2
.子程序 示例2
    调试输出("示例2")
```
### HDLUA_执行CALL - 高级应用
```
.版本 2
.子程序 高级示例
    调试输出("高级示例")
```

---
